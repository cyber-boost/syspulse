# Full-featured daemon configuration demonstrating all available options.

[daemon]
# Required: unique name for this daemon
name = "my-production-api"

# Required: command and arguments to execute
command = ["node", "dist/server.js", "--port", "3000"]

# Optional: working directory (defaults to current directory)
working_dir = "/opt/my-app"

# Optional: human-readable description
description = "Production API server handling user requests"

# Optional: run as a specific user (Unix only)
user = "www-data"

# Optional: cron schedule (daemon runs on schedule instead of continuously)
# schedule = "0 */6 * * *"

# Optional: seconds to wait for graceful shutdown before force-killing (default: 30)
stop_timeout_secs = 60

# Optional: tags for grouping and filtering
tags = ["web", "production", "api"]

# Optional: environment variables passed to the process
[daemon.env]
NODE_ENV = "production"
PORT = "3000"
LOG_LEVEL = "info"
DATABASE_URL = "postgres://localhost:5432/myapp"

# Optional: health check configuration
[daemon.health_check]
# Type: "http", "tcp", or "command"
type = "http"
# Target depends on type:
#   http    -> URL to GET (expects 2xx response)
#   tcp     -> "host:port" to connect to
#   command -> shell command (exit 0 = healthy)
target = "http://127.0.0.1:3000/health"
# Seconds between health checks (default: 30)
interval_secs = 15
# Seconds before a single check times out (default: 5)
timeout_secs = 3
# Consecutive failures before marking unhealthy (default: 3)
retries = 5
# Seconds to wait after start before first health check (default: 0)
start_period_secs = 10

# Optional: restart policy
[daemon.restart_policy]
# Policy: "always", "on_failure", or "never" (default: "never")
policy = "on_failure"
# Maximum restart attempts (omit for unlimited)
max_retries = 10
# Initial backoff delay in seconds (doubles each attempt) (default: 1.0)
backoff_base_secs = 2.0
# Maximum backoff delay in seconds (default: 300.0)
backoff_max_secs = 120.0

# Optional: resource limits
[daemon.resource_limits]
# Maximum memory in bytes (512 MB)
max_memory_bytes = 536870912
# Maximum CPU usage as a percentage
max_cpu_percent = 80.0
# Maximum number of open file descriptors
max_open_files = 1024

# Optional: log configuration
[daemon.log_config]
# Maximum log file size in bytes before rotation (100 MB)
max_size_bytes = 104857600
# Number of rotated log files to keep
retain_count = 10
# Compress rotated log files with gzip
compress_rotated = true
