# Windows-specific daemon examples
# Paths use backslashes, commands reference Windows executables and services.

[[daemon]]
name = "iis-watchdog"
command = ["powershell", "-NoProfile", "-Command", "while ($true) { if ((Get-Service W3SVC).Status -ne 'Running') { Start-Service W3SVC }; Start-Sleep -Seconds 30 }"]
working_dir = "C:\\inetpub"
description = "Monitors IIS and restarts it if stopped"
tags = ["windows", "iis", "watchdog"]

[daemon.health_check]
type = "tcp"
target = "127.0.0.1:80"
interval_secs = 15
timeout_secs = 3
retries = 3
start_period_secs = 10

[daemon.restart_policy]
policy = "always"
backoff_base_secs = 5
backoff_max_secs = 60

[[daemon]]
name = "dotnet-api"
command = ["dotnet", "run", "--project", "MyApi.csproj", "--urls", "http://0.0.0.0:5000"]
working_dir = "C:\\Projects\\MyApi"
description = ".NET Web API server"
stop_timeout_secs = 15
tags = ["windows", "dotnet", "api"]

[daemon.env]
ASPNETCORE_ENVIRONMENT = "Production"
DOTNET_CLI_TELEMETRY_OPTOUT = "1"

[daemon.health_check]
type = "http"
target = "http://127.0.0.1:5000/health"
interval_secs = 20
timeout_secs = 5
retries = 3

[daemon.restart_policy]
policy = "on_failure"
max_retries = 10
backoff_base_secs = 2
backoff_max_secs = 120

[daemon.resource_limits]
max_memory_bytes = 1073741824   # 1 GB
max_cpu_percent = 50.0

[daemon.log_config]
max_size_bytes = 52428800       # 50 MB
retain_count = 5

[[daemon]]
name = "scheduled-backup"
command = ["powershell", "-File", "C:\\Scripts\\backup.ps1"]
working_dir = "C:\\Scripts"
description = "Nightly database backup via PowerShell"
schedule = "0 2 * * *"
tags = ["windows", "backup", "scheduled"]

[daemon.restart_policy]
policy = "on_failure"
max_retries = 2
backoff_base_secs = 30
backoff_max_secs = 300
